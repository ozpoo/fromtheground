<?php get_header(); ?>

	<main role="main">

		<section class="calendar-wrapper">

			<section class="calendar-header">
				<!-- <div class="left">
					<ul>
						<li>
							<a href="<?php echo get_site_url(null, '/', 'http'); ?>">
								<svg version="1.1"
									 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/"
									 x="0px" y="0px" width="70px" height="45.8px" viewBox="0 0 70 45.8" style="enable-background:new 0 0 70 45.8;"
									 xml:space="preserve">
								<g>
									<path class="st0" d="M53.9,17.6c0.6-0.3,1.1-0.5,1.6-0.8c2.7-1.6,5.7-2.8,8.8-3.4c1.3-0.3,2.6-0.3,3.9-0.5c0.3,0,0.7-0.1,1-0.1
										c0.3,0,0.5,0,0.7,0.2c0.2,0.3,0.1,0.5-0.1,0.8c-0.3,0.4-0.6,0.8-0.8,1.2c-0.4,0.6-0.8,1.1-1.5,1.3c-0.8,0.3-1.6,0.6-2.3,0.9
										c-0.5,0.2-1.2,0.4-1.5,0.8c-0.4,0.5-0.6,1.2-0.7,1.8c-0.2,1.2-0.3,2.4-0.4,3.6c-0.1,1.2-0.6,2.3-1.1,3.4c-0.5,1.2-1.1,2.4-1.5,3.6
										c-0.3,1-0.5,2-1.2,2.9c-0.1,0.2-0.2,0.4-0.2,0.6c-0.1,1.4-0.9,2.6-1.2,3.9c0,0.1-0.1,0.2-0.3,0.4c-0.4-0.5-0.5-1.1-0.5-1.7
										c0-0.5,0-0.9,0-1.4c0-0.7-0.2-1.4,0.1-2.1c0,0,0-0.1,0-0.1c0-1,0.2-2,0.3-3c0.1-0.4-0.2-0.6-0.6-0.4c-0.6,0.2-1.1,0.5-1.6,0.9
										c-0.7,0.5-1.3,1.1-1.9,1.6c-0.2,0.1-0.3,0.3-0.4,0.5c-0.5,0.8-1.3,1.3-2,1.9c-0.7,0.5-1.4,0.6-2.1,0.2c-1.1-0.6-2.2-1.2-3.1-2.2
										c-0.3-0.3-0.4-0.7-0.4-1.1c0.1-0.5,0.1-1,0.2-1.5c0.3-1.1,0.7-2.1,1-3.2c0-0.1,0.1-0.1,0.1-0.2c0.4-2.1,1.4-3.9,2-5.9
										c0.6-1.9,1.1-3.9,1.4-5.8c0.1-0.9,0.1-1.6-0.6-2.3c-0.3-0.2-0.5-0.6-0.7-0.9c-0.4-0.5-0.4-0.6,0.1-1.1c1-1,2.2-1.6,3.4-2.2
										c1.2-0.6,2.3-1.2,3.5-1.7c2.1-1,4.2-2,6.2-3.2c0.9-0.6,1.9-1,2.9-1.5C65.7,1.2,67,0.5,68.4,0c0.1,0,0.2,0,0.1,0
										c0.4,0.3,0.8,0.5,1.2,0.7C69.6,1,69.3,1.2,69,1.3c-0.2,0.1-0.4,0.1-0.5,0.2c-0.4,0.6-1,1-1.5,1.4C67,3,66.9,3,66.9,3
										c-0.1,0.7-0.9,1-1.1,1.7c-0.2,0.5-0.6,0.7-1,0.9c-0.3,0.1-0.6,0.3-0.8,0.4c-0.2,0.1-0.3,0.3-0.5,0.4c-0.8,0.3-1.4,0.8-2,1.4
										c-0.3,0.3-0.6,0.6-1,0.8c-0.4,0.3-0.7,0.6-1,1c-0.1,0.2-0.4,0.4-0.6,0.5c-0.9,0.5-1.7,1-2.3,1.7c-0.1,0.1-0.4,0.2-0.5,0.4
										c-0.2,0.2-0.5,0.3-0.7,0.6c-0.4,0.5-0.7,1-1.2,1.4c0,0-0.1,0.1-0.1,0.1C53.6,15.3,53.7,16.3,53.9,17.6z M58.9,20.7
										c-0.3,0-0.5,0-0.7,0.1c-0.4,0.1-0.7,0.1-1.1-0.1c-0.5-0.2-1.1-0.3-1.5-0.8c-0.3-0.3-0.7-0.6-1.1-0.9c-0.5-0.4-0.8-0.3-1,0.3
										c-0.1,0.2-0.1,0.5-0.2,0.7c-0.2,0.7-0.3,1.5-0.5,2.2c-0.2,0.5-0.4,1-0.6,1.5c-0.2,0.8-0.3,1.7-0.9,2.4c-0.1,0.1,0,0.2,0,0.3
										c0.6,0.3,1.1,0,1.6-0.3c1.2-0.7,2.5-1.4,3.9-1.8c0.4-0.1,0.8-0.3,1.2-0.5c0.2-0.1,0.4-0.4,0.5-0.7c0.1-0.4,0-0.8,0-1.1
										C58.6,21.6,58.7,21.2,58.9,20.7z"/>
									<path class="st0" d="M10.3,28.7c-0.1,0.2-0.2,0.4-0.3,0.5c-0.4,0.8-0.8,1.6-1.2,2.4c-0.2,0.3-0.3,0.7-0.5,1
										c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.3-0.2,0.6-0.4,0.9c-0.4,0.4-0.5,0.8-0.5,1.3c0,0.4-0.1,0.7-0.3,1c-0.2,0.3-0.3,0.7-0.4,1.1
										c-0.1,0.4-0.2,0.7-0.6,0.9c-0.3,0.2-0.4,0.4-0.5,0.8c-0.1,0.7-0.4,1.4-0.9,2c-0.6,0.7-1.1,1.5-1.7,2.2c-0.7,1.1-1.7,1.8-2.8,2.6
										C-0.1,45.4,0,45,0.1,44.7c0.5-1.5,1-3,1.4-4.5c0.6-2.2,1.3-4.3,1.9-6.5c0.7-2.8,1.4-5.6,2-8.4c0.3-1.5,0.7-3.1,0.8-4.7
										c0.2-1.9,0.2-3.9-0.1-5.8c0-0.2-0.2-0.4-0.3-0.6c-0.3-0.5-0.4-0.7,0.1-1.1c0.7-0.6,1.4-1.2,2.2-1.7C9.1,10.6,10,10,11,9.4
										c2.2-1.2,4.4-2.5,6.7-3.4c0.9-0.4,1.8-0.1,2.5,0.9c0.8,1,0.7,1.9-0.2,3.1c-0.8,0.9-1.6,1.7-2.4,2.5c-0.7,0.7-1.6,1.1-2.3,1.9
										c-0.9,1-2,1.7-3,2.5c-0.3,0.2-0.4,0.5-0.2,0.9c0.4,0.8,0.5,1.7,0.2,2.6c-0.1,0.2-0.1,0.5,0,0.7c0.1,0.4,0.2,0.8,0,1.2
										c-0.2,0.4,0.1,0.7,0.6,0.6c0.2,0,0.5,0,0.7-0.1c1.4-0.4,2.8-0.8,4.2-1.1c0.3-0.1,0.8-0.2,1.1,0c0.4,0.3,0.8,0.8,0.8,1.3
										c0.1,0.8,0,1.4-0.7,2c-0.8,0.5-1.5,1.3-2.3,1.9c-0.2,0.1-0.4,0.3-0.5,0.5c-0.4,0.7-1.1,1.1-1.8,1.3c-0.6,0.2-1.2,0.4-1.7,0.6
										c-0.6,0.3-1.1,0.2-1.7-0.2C10.8,29,10.7,28.9,10.3,28.7z"/>
									<path class="st0" d="M25.8,36.3c0-0.2,0.1-0.4,0.2-0.7c0.3-1,0.6-2,0.9-2.9c0.5-1.3,1-2.5,1.5-3.7c0.1-0.1,0.1-0.2,0.2-0.4
										c0.4-1.8,1.3-3.5,1.4-5.4c0-0.2,0-0.4,0-0.6c0-0.6,0.1-1.2,0.1-1.7c0.1-1-0.1-1.3-1-1.5c-0.1,0-0.3-0.1-0.4-0.1
										c-2.1-0.3-3.6-1.7-5.1-3.2c-0.4-0.4-0.3-0.8,0.2-1.1c0.5-0.3,1.1-0.5,1.6-0.8c1.1-0.5,2.3-1,3.4-1.6c0.9-0.4,1.8-0.9,2.7-1.3
										c0.8-0.4,1.6-0.9,2.5-1.4c1.6-0.8,3.2-1.7,4.9-2.5c1.2-0.6,2.3-0.1,2.7,1.1c0,0.1,0.1,0.3,0,0.4c-0.2,0.6-0.4,1.2-0.7,1.8
										c-0.4,0.7-0.8,1.5-1.5,2.1c-0.2,0.1-0.4,0.3-0.6,0.4c-0.9,0.4-1.5,1-2.2,1.6c-0.5,0.4-1,0.8-1.5,1.2c-0.3,0.2-0.5,0.4-0.8,0.6
										c-0.3,0.3-0.4,0.6-0.3,1c0.2,0.6,0.4,1.2,0.8,1.8c0.5,0.8,0.9,1.7,0.8,2.7c-0.1,1.1,0,2.2-0.2,3.2c-0.1,0.8-0.5,1.6-0.9,2.3
										c-0.4,0.8-0.9,1.5-1.4,2.2c-0.4,0.6-0.8,1.3-1.2,1.9c-0.2,0.3-0.5,0.6-0.7,0.9c-0.2,0.2-0.4,0.4-0.4,0.7c-0.1,0.6-0.5,0.9-0.9,1.3
										c-0.5,0.5-0.8,1-1.3,1.4c-0.5,0.5-1.1,0.9-1.7,1.2C26.3,37.8,25.8,37.4,25.8,36.3z"/>
								</g>
								</svg>
							</a>
						</li>
					</ul>
				</div> -->
				<div class="center">
					<ul>
						<li><button><</button></li>
						<li>
							<?php $monthArray = range(1, 12); ?>
							<select name="month">
						    <option value="">Select Month</option>
						    <?php
						    foreach ($monthArray as $month) {
					        $monthPadding = str_pad($month, 2, "0", STR_PAD_LEFT);
					        $year = date("Y");
									$month = date("m");
					        $fdate = date("F", strtotime($year.'-'.$monthPadding.'-01'));
									// Select current month
									if($month == $monthPadding):
										echo '<option selected="selected" value="'.$monthPadding.'">'.$fdate.' '.$year.'</option>';
									else:
					        	echo '<option value="'.$monthPadding.'">'.$fdate.' '.$year.'</option>';
									endif;
						    }
						    ?>
							</select>
						</li>
						<li><button>></button></li>
					</ul>
				</div>
				<div class="right">
					<ul>
						<li><button class="button go-to-day" data-date="<?php echo date('d'); ?>"><small>Today</small></button></li>
					</ul>
				</div>
			</section>

			<?php
				$month = date("m");
				$start = date("Y-".$month."-01");
				$end = date("Y-".$month."-t");

				$args = array (
					'post_type'				=> 'programming',
					'posts_per_page'	=> -1,
					'orderby'					=> 'meta_value',
					'order'						=> 'ASC',
					'meta_query' 			=> array(
						'relation' 			=> 'AND',
						array(
							'key'       	=> 'date',
							'compare'   	=> '>=',
							'value'     	=> $start,
							'type'      	=> 'DATE'
						),
						array(
							'key'       	=> 'date',
							'compare'   	=> '<=',
							'value'     	=> $end,
							'type'      	=> 'DATE'
						)
					),
				);

				$the_query = new WP_Query( $args );
				$posts = $the_query->posts;

				$current = 0;
				$month = date('m');
				$year = date('Y');

				$days = array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
				$running_day = date('w',mktime(0,0,0,$month,1,$year));
				$days_in_month = date('t',mktime(0,0,0,$month,1,$year));
				$days_in_this_week = 1;
				$day_counter = 0;
				$dx = 0;
				$dy = 0;
				$dates_array = array();
			?>

			<section class="calendar-container">
				<div class="calendar-row" data-y="<?php echo $dy++; ?>">

				<!-- Blank days before this month -->
				<?php for($x = 0; $x < $running_day; $x++): ?>
					<div class="calendar-day np" data-x="<?php echo $dx++; ?>">
						<div class="content"></div>
					</div>
					<?php $days_in_this_week++; ?>
				<?php endfor; ?>

				<?php
					$post = $posts[$current];
					setup_postdata($post);
				?>

				<!-- Days this month -->
				<?php for($day = 1; $day <= $days_in_month; $day++): ?>
					<?php
						$date = get_field("date");
						$date = DateTime::createFromFormat('m/d/Y', $date);
						$date = $date->format('d');
					?>
						<div class="calendar-day" data-date="<?php echo $day; ?>" data-x="<?php echo $dx++; ?>">
							<div class="content">
								<div class="number">
									<p><?php echo $day; ?></p>
								</div>
								<div class="day">
									<p><small><?php echo $days[$day%7]; ?></small></p>
								</div>
								<div class="list">
									<?php while($date == $day): ?>
										<?php
										$title = $movement = $description = $notes = null;
										if( have_rows('workout_type') ):
									    while ( have_rows('workout_type') ) : the_row();
								        if( get_row_layout() == 'custom' ):
													$title = get_sub_field('title');
													$description = get_sub_field('description');
													$notes = get_sub_field('notes');
								        elseif( get_row_layout() == 'benchmark' ):
													$title = get_the_title(get_sub_field('workout'));
													$notes = get_sub_field('notes');
												elseif( get_row_layout() == 'movement' ):
													$title = get_sub_field('title');
													$movement = get_the_title(get_sub_field('movement'));
													$description = get_sub_field('description');
													$notes = get_sub_field('notes');
								        endif;
									    endwhile;
										endif;
										?>
										<p>
											<?php if($title): ?>
												<strong><?php echo $title; ?></strong>
											<?php endif; ?>
											<?php if($movement): ?>
												<?php if($title): ?><br><?php endif; ?>
												<?php if(!$title): ?><strong><?php endif; ?>
												<?php echo $movement; ?>
												<?php if(!$title): ?></strong><?php endif; ?>
											<?php endif; ?>
											<?php if($description): ?>
												<br><?php echo $description; ?>
											<?php endif; ?>
											<?php if($notes): ?>
												<br><small><?php echo $notes; ?></small>
											<?php endif; ?>
										</p>
										<?php
											wp_reset_postdata();
											$current++;
											$post = $posts[$current];
											setup_postdata($post);
											$date = get_field("date");
											$date = DateTime::createFromFormat('m/d/Y', $date);
											$date = $date->format('d');
										?>
									<?php endwhile; ?>
								</div>
								<!-- <p>
									<small>
										Lorem ipsum dolor sit amet, homero necessitatibus mei id, mea quas errem at, vis an mutat regione denique. Facer voluptua ex sea, ne eum discere expetendis. Vel an legere minimum pertinax, no amet erant saepe vix. Per te consul debitis fastidii, ei vix ullum causae, vim primis accusam disputando no. Epicurei persecuti ei vis, no quo tantas recteque.
									</small>
								</p>
								<p><button class="button"><small>Edit</small></button></p> -->
						</div>
					</div>
					<?php if($running_day == 6): ?>
						</div>
						<?php if(($day_counter+1) != $days_in_month): ?>
							<div class="calendar-row" data-y="<?php echo $dy++; ?>">
							<?php $dx = 0;
						endif;
						$running_day = -1;
						$days_in_this_week = 0;
						endif;
					$days_in_this_week++;
					$running_day++;
					$day_counter++;
					endfor;
				?>

				<?php wp_reset_postdata(); ?>

				<!-- Blank days after this month -->
				<?php if($days_in_this_week < 8): ?>
					<?php for($x = 1; $x <= (8 - $days_in_this_week); $x++): ?>
						<div class="calendar-day np" data-x="<?php echo $dx++; ?>">
							<div class="content"></div>
						</div>
					<?php endfor; ?>
				<?php endif; ?>

				</div>

			</section>

		</section>

	</main>

<?php get_footer(); ?>
